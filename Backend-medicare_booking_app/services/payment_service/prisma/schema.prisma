// This is your Prisma schema file for Appointment Management Service
// Learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// prisma/schema.prisma
model Payment {
  id              String         @id @default(uuid())
  appointmentId   String // lấy từ client hoặc từ service booking
  txnRef          String         @unique // vnp_TxnRef (do mình tạo)
  transactionNo   String?        @map("transaction_no") // vnp_TransactionNo (do VNPay trả về) - BẮT BUỘC để refund
  amount          Int // VND (nhân 100 theo chuẩn VNPay, xem ghi chú)
  gateway         PaymentGateway @default(VNPAY)
  state           PaymentState   @default(PENDING)
  hospitalId      String
  patientId       String
  orderInfo       String
  bankCode        String?
  payDate         DateTime?
  transactionDate String?        @map("transaction_date") // vnp_PayDate format: yyyyMMddHHmmss - BẮT BUỘC để refund
  rawQuery        String?        @db.Text // lưu full query VNPay (debug/audit)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
}

enum PaymentGateway {
  VNPAY
  CASH
}

enum PaymentState {
  PENDING
  PAID
  FAILED
  CANCELED
}
