// This is your Prisma schema file for Message Service
// Learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Bảng cuộc trò chuyện
model Conversation {
  id            Int              @id @default(autoincrement())
  patientId     String           @map("patient_id") @db.VarChar(255)
  doctorId      String?          @map("doctor_id") @db.VarChar(255)
  supportId     String?          @map("support_id") @db.VarChar(255)
  type          ConversationType
  lastMessageAt DateTime         @default(now()) @map("last_message_at")
  createdAt     DateTime         @default(now()) @map("created_at")
  updatedAt     DateTime         @updatedAt @map("updated_at")

  // Quan hệ với bảng Message
  messages Message[]

  @@index([lastMessageAt])
  @@map("conversations")
}

// Bảng tin nhắn
model Message {
  id             Int         @id @default(autoincrement())
  conversationId Int         @map("conversation_id")
  senderId       String      @map("sender_id") @db.VarChar(255)
  senderType     SenderType  @map("sender_type")
  content        String      @db.Text
  messageType    MessageType @default(TEXT) @map("message_type")
  fileUrl        String?     @map("file_url") @db.VarChar(500)
  fileName       String?     @map("file_name") @db.VarChar(255)
  fileSize       Int?        @map("file_size")
  isRead         Boolean     @default(false) @map("is_read")
  isDelivered    Boolean     @default(false) @map("is_delivered")
  createdAt      DateTime    @default(now()) @map("created_at")
  updatedAt      DateTime    @updatedAt @map("updated_at")

  // Quan hệ với bảng Conversation
  conversation Conversation @relation(fields: [conversationId], references: [id])

  @@map("messages")
}

// Enum cho loại cuộc trò chuyện
enum ConversationType {
  DOCTOR_PATIENT
  SUPPORT
}

// Enum cho loại người gửi
enum SenderType {
  PATIENT
  DOCTOR
  SUPPORT
}

// Enum cho loại tin nhắn
enum MessageType {
  TEXT
  IMAGE
  FILE
  AUDIO
  VIDEO

}
